import { ImageResponse } from '@vercel/og'
import { type NextRequest } from 'next/server'

export const config = {
  runtime: 'edge',
}

export default async function handler(
  request: NextRequest
): Promise<ImageResponse> {
  const { searchParams } = new URL(request.url)

  // ?title=<title>
  const title = searchParams.has('title') ? searchParams.get('title') ?? '' : ''
  const university = searchParams.has('university')
    ? searchParams.get('university') ?? ''
    : ''
  const subject = searchParams.has('subject')
    ? searchParams.get('subject') ?? ''
    : ''
  const user = searchParams.has('user') ? searchParams.get('user') ?? '' : ''

  const nunitoSansMedium = await fetch(
    new URL('../../assets/NunitoSans-Medium.ttf', import.meta.url)
  ).then(async res => await res.arrayBuffer())

  const nunitoSansBold = await fetch(
    new URL('../../assets/NunitoSans-Bold.ttf', import.meta.url)
  ).then(async res => await res.arrayBuffer())

  return new ImageResponse(
    (
      <div
        style={{
          display: 'flex',
          flexDirection: 'column',
          fontSize: 56,
          background: 'linear-gradient(to left top, #08213F, #1B406F)',
          lineHeight: 1,
          width: '100%',
          height: '100%',
          padding: '164px 50px',
          color: 'white',
          justifyContent: 'center',
          gap: 40,
        }}
      >
        <span
          style={{
            display: 'block',
            textOverflow: 'ellipsis',
            lineClamp: 2,
            fontWeight: '700',
          }}
        >
          {title}
        </span>
        <div
          style={{
            display: 'flex',
            gap: 10,
            flexDirection: 'column',
          }}
        >
          <span
            style={{
              display: 'flex',
              alignItems: 'center',
              fontWeight: '500',
              fontSize: 36,
            }}
          >
            🏫 {university}
          </span>
          <span
            style={{
              display: 'flex',
              alignItems: 'center',
              fontWeight: '500',
              fontSize: 36,
            }}
          >
            📓 {subject}
          </span>
          <span
            style={{
              display: 'flex',
              alignItems: 'center',
              fontWeight: '500',
              fontSize: 36,
            }}
          >
            👤 @{user}
          </span>
        </div>
        <Imagotipo />
      </div>
    ),
    {
      width: 1200,
      height: 630,
      fonts: [
        { name: 'nunitoSans', data: nunitoSansMedium, weight: 500 },
        { name: 'nunitoSans', data: nunitoSansBold, weight: 700 },
      ],
    }
  )
}

const Imagotipo = (): JSX.Element => (
  <svg
    width="203"
    height="64"
    viewBox="0 0 203 64"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
    style={{
      position: 'absolute',
      bottom: '50px',
      right: '50px',
    }}
  >
    <g clipPath="url(#clip0_3050_26)">
      <path
        d="M25.8517 46.0863L29.4778 42.4512L29.6132 42.3154C29.655 42.2835 29.6889 42.2425 29.7124 42.1954C29.7359 42.1483 29.7483 42.0965 29.7487 42.0438V32.1101C29.7432 29.8568 28.8478 27.6973 27.2584 26.1039C25.6689 24.5105 23.5147 23.6129 21.2669 23.6074H11.6807C11.5857 23.6074 11.4945 23.6445 11.4264 23.7108C11.3583 23.7771 11.3187 23.8674 11.316 23.9626V43.6525C11.3104 45.0849 11.8706 46.4613 12.8741 47.481C13.8776 48.5007 15.2429 49.0808 16.6718 49.0946H18.339C18.4339 49.0946 18.5251 49.0576 18.5932 48.9912C18.6613 48.9249 18.7009 48.8346 18.7036 48.7395V31.3371C18.7036 31.242 18.7406 31.1505 18.8068 31.0823C18.8729 31.014 18.963 30.9743 19.0579 30.9715H21.2669C21.5582 30.9769 21.836 31.0953 22.042 31.3018C22.248 31.5083 22.3661 31.7868 22.3714 32.0788V48.6872C22.3714 48.7814 22.4088 48.8718 22.4752 48.9384C22.5416 49.005 22.6318 49.0424 22.7257 49.0424H24.7055C24.7538 49.0425 24.8017 49.0326 24.8461 49.0135C24.8905 48.9944 24.9305 48.9663 24.9637 48.9311C24.9969 48.8959 25.0225 48.8542 25.039 48.8087C25.0556 48.7631 25.0626 48.7147 25.0598 48.6663C24.9689 48.2042 24.9937 47.7266 25.1319 47.2764C25.2701 46.8262 25.5174 46.4173 25.8517 46.0863Z"
        fill="#EA0029"
      />
      <path
        d="M51.2241 23.6172H41.6795C39.4317 23.6227 37.2775 24.5203 35.6881 26.1137C34.0986 27.707 33.2033 29.8665 33.1978 32.1199V41.9387C33.1995 41.9926 33.2124 42.0455 33.2357 42.0941C33.2591 42.1427 33.2923 42.1858 33.3332 42.2207C33.4282 42.2917 33.5186 42.3684 33.6041 42.4505L37.2198 46.0856C37.5623 46.4261 37.8135 46.8479 37.9502 47.3117C38.0868 47.7755 38.1044 48.2663 38.0013 48.7388C37.9827 48.8301 38.0007 48.9252 38.0514 49.0033C38.1021 49.0815 38.1814 49.1365 38.2722 49.1566H43.1487C45.401 49.1566 47.561 48.2597 49.1536 46.6632C50.7462 45.0666 51.6409 42.9013 51.6409 40.6435V24.0246C51.6528 23.9291 51.6266 23.8328 51.5681 23.7565C51.5096 23.6803 51.4234 23.6302 51.3283 23.6172H51.2241ZM44.2011 40.6539C44.2096 40.9413 44.1052 41.2206 43.9103 41.4316C43.7154 41.6426 43.4457 41.7685 43.1591 41.782H40.8876C40.7909 41.782 40.6981 41.7435 40.6297 41.675C40.5613 41.6064 40.5229 41.5134 40.5229 41.4164V32.1199C40.5242 31.9704 40.5554 31.8227 40.6146 31.6855C40.6739 31.5483 40.76 31.4245 40.8678 31.3212C40.9756 31.218 41.103 31.1375 41.2425 31.0845C41.3819 31.0315 41.5305 31.0071 41.6795 31.0126H43.5447C43.7409 31.0126 43.9291 31.0908 44.0678 31.2299C44.2065 31.369 44.2845 31.5576 44.2845 31.7543L44.2011 40.6539Z"
        fill="#EA0029"
      />
      <path
        d="M35.8131 47.0048L33.1456 44.3412L32.3954 43.5786C32.2792 43.4618 32.1412 43.3691 31.9892 43.3058C31.8372 43.2425 31.6743 43.21 31.5097 43.21C31.3451 43.21 31.1822 43.2425 31.0302 43.3058C30.8782 43.3691 30.7402 43.4618 30.624 43.5786L29.7487 44.4665L27.2063 47.0048C26.9328 47.274 26.7638 47.632 26.7294 48.0148C26.695 48.3975 26.7976 48.78 27.0187 49.0939L30.4781 54.1809C30.6627 54.4553 30.9472 54.6462 31.2706 54.7126C31.594 54.779 31.9305 54.7156 32.2078 54.536C32.3482 54.4424 32.4687 54.3217 32.5621 54.1809L35.959 49.1879L36.0215 49.0939C36.24 48.7776 36.3391 48.3937 36.3009 48.0109C36.2627 47.6281 36.0898 47.2714 35.8131 47.0048Z"
        fill="#EA0029"
      />
      <path
        d="M47.9836 15.9395L46.9416 15.8351C46.8969 15.8337 46.8529 15.8234 46.8122 15.8047C46.7716 15.786 46.7351 15.7593 46.7049 15.7262C46.6748 15.693 46.6516 15.6541 46.6368 15.6118C46.6219 15.5695 46.6157 15.5247 46.6186 15.4799V10.2571C46.6161 10.1655 46.5794 10.0781 46.5157 10.0124C46.452 9.94658 46.366 9.90718 46.2747 9.90198H45.1285C44.7742 9.90198 36.9802 9.65129 31.3951 13.7042C31.3352 13.7499 31.262 13.7747 31.1867 13.7747C31.1114 13.7747 31.0382 13.7499 30.9783 13.7042C25.3308 9.52594 17.5054 9.78708 17.1407 9.79752H15.9425C15.8512 9.80273 15.7652 9.84212 15.7015 9.9079C15.6378 9.97368 15.6011 10.061 15.5986 10.1527V15.3755C15.5967 15.4638 15.5629 15.5484 15.5035 15.6137C15.4441 15.679 15.3632 15.7205 15.2756 15.7306H15.2026L14.1607 15.8455C14.0731 15.8556 13.9921 15.8971 13.9328 15.9624C13.8734 16.0277 13.8396 16.1123 13.8376 16.2007V21.319C13.8404 21.4141 13.88 21.5045 13.9481 21.5708C14.0162 21.6371 14.1074 21.6742 14.2023 21.6741H16.5781C16.673 21.6742 16.7642 21.6371 16.8323 21.5708C16.9004 21.5045 16.9401 21.4141 16.9428 21.319V19.1776C16.9399 19.1293 16.947 19.0808 16.9635 19.0353C16.98 18.9898 17.0057 18.9481 17.0389 18.9129C17.0721 18.8777 17.1121 18.8496 17.1565 18.8305C17.2009 18.8114 17.2487 18.8015 17.297 18.8016C20.2459 18.8016 26.2165 19.2403 29.5196 22.8127L29.7696 23.0947H32.4059L32.5205 22.9798L32.6247 22.8545C35.9278 19.2821 41.8984 18.7807 44.8055 18.8329C44.852 18.8329 44.8981 18.8421 44.9411 18.86C44.9841 18.8778 45.0231 18.904 45.056 18.937C45.0889 18.9699 45.115 19.0091 45.1328 19.0522C45.1506 19.0953 45.1598 19.1415 45.1598 19.1881V21.413C45.1598 21.51 45.1982 21.6029 45.2666 21.6715C45.335 21.7401 45.4277 21.7786 45.5245 21.7786H47.9315C48.0282 21.7786 48.1209 21.7401 48.1893 21.6715C48.2577 21.6029 48.2962 21.51 48.2962 21.413V16.3051C48.2949 16.2171 48.263 16.1324 48.2059 16.0656C48.1488 15.9988 48.0701 15.9542 47.9836 15.9395ZM29.4883 18.154C29.4883 18.2482 29.451 18.3385 29.3845 18.4051C29.3181 18.4717 29.228 18.5091 29.134 18.5091C29.0724 18.5246 29.008 18.5246 28.9465 18.5091C25.9064 16.8268 22.5084 15.8991 19.0372 15.8037C18.9469 15.7984 18.862 15.7586 18.8 15.6926C18.738 15.6266 18.7036 15.5393 18.7037 15.4486V13.3595C18.7023 13.3128 18.7101 13.2664 18.7267 13.2227C18.7432 13.1791 18.7681 13.1392 18.8001 13.1052C18.832 13.0713 18.8703 13.044 18.9128 13.0249C18.9552 13.0058 19.0011 12.9952 19.0476 12.9939C21.5588 13.1819 26.0706 13.8713 29.3216 16.42C29.3636 16.454 29.3975 16.497 29.4209 16.5458C29.4444 16.5945 29.4567 16.6479 29.457 16.702L29.4883 18.154ZM43.4092 15.4277C43.4094 15.5184 43.3749 15.6057 43.3129 15.6717C43.2509 15.7377 43.1661 15.7775 43.0758 15.7828C39.6061 15.8885 36.2105 16.8156 33.1665 18.4882C33.1269 18.5131 33.0827 18.5299 33.0366 18.5376C32.9905 18.5452 32.9433 18.5437 32.8978 18.533C32.8522 18.5223 32.8093 18.5027 32.7713 18.4753C32.7334 18.4479 32.7013 18.4133 32.6768 18.3733C32.6436 18.3162 32.6257 18.2514 32.6247 18.1853V16.7125C32.6264 16.6586 32.6393 16.6057 32.6626 16.5571C32.686 16.5085 32.7192 16.4654 32.7601 16.4305C36.0111 13.8817 40.5229 13.1923 43.0341 13.0148C43.0793 13.0105 43.1249 13.0152 43.1683 13.0286C43.2116 13.0421 43.2519 13.064 43.2868 13.0931C43.3217 13.1222 43.3504 13.158 43.3715 13.1983C43.3925 13.2387 43.4053 13.2828 43.4092 13.3281V15.4172V15.4277Z"
        fill="#EA0029"
      />
      <path
        d="M48.7858 63.0599H14.1189C10.376 63.0544 6.78804 61.5614 4.14142 58.9083C1.49481 56.2551 0.00551235 52.6583 0 48.9062L0 14.1537C0.00551235 10.4016 1.49481 6.80479 4.14142 4.15164C6.78804 1.49849 10.376 0.00552594 14.1189 0L48.7858 0C52.5287 0.00552594 56.1167 1.49849 58.7633 4.15164C61.4099 6.80479 62.8992 10.4016 62.9047 14.1537V48.9062C62.8992 52.6583 61.4099 56.2551 58.7633 58.9083C56.1167 61.5614 52.5287 63.0544 48.7858 63.0599ZM14.1189 5.3168C11.781 5.3168 9.5388 6.24783 7.88563 7.90508C6.23246 9.56233 5.30371 11.81 5.30371 14.1537V48.9062C5.30371 51.2499 6.23246 53.4976 7.88563 55.1548C9.5388 56.8121 11.781 57.7431 14.1189 57.7431H48.7858C51.1238 57.7431 53.3659 56.8121 55.0191 55.1548C56.6723 53.4976 57.601 51.2499 57.601 48.9062V14.1537C57.601 11.81 56.6723 9.56233 55.0191 7.90508C53.3659 6.24783 51.1238 5.3168 48.7858 5.3168H14.1189Z"
        fill="white"
      />
      <path
        d="M119.547 47.3078H108.221V28.2028C108.221 25.8287 109.162 23.5517 110.836 21.8729C112.511 20.1941 114.782 19.251 117.151 19.251H128.477V38.3664C128.474 40.7387 127.532 43.013 125.858 44.6895C124.183 46.3661 121.914 47.3078 119.547 47.3078ZM116.327 39.1811H119.547C119.765 39.1811 119.975 39.0942 120.129 38.9394C120.284 38.7847 120.37 38.5748 120.37 38.3559V27.7955C120.365 27.6835 120.319 27.5775 120.24 27.4983C120.16 27.419 120.055 27.3723 119.943 27.3672H117.151C116.932 27.3672 116.723 27.4541 116.568 27.6089C116.414 27.7636 116.327 27.9735 116.327 28.1924V39.1811Z"
        fill="white"
      />
      <path
        d="M154.777 24.7562C154.779 24.0315 154.639 23.3134 154.365 22.6432C154.09 21.9729 153.686 21.3636 153.176 20.8502C152.666 20.3368 152.059 19.9294 151.392 19.6515C150.724 19.3735 150.008 19.2305 149.285 19.2305H132.228V27.3571H139.522V47.2037H147.639V27.3571H154.725L154.777 24.7562Z"
        fill="white"
      />
      <path
        d="M170.438 19.2197V27.7538H166.645V19.2197H158.538V40.7376C158.537 41.5826 158.702 42.4196 159.023 43.2008C159.344 43.982 159.816 44.692 160.411 45.2905C161.006 45.889 161.713 46.3641 162.491 46.6887C163.269 47.0134 164.104 47.1811 164.947 47.1825H166.645V35.8909H170.438V47.2139H178.555V19.2197H170.438Z"
        fill="white"
      />
      <path
        d="M202.062 19.2305H193.955V27.7541H190.413V19.2305H182.348V28.8404C182.348 30.7104 183.089 32.5038 184.408 33.826C185.727 35.1483 187.516 35.8912 189.381 35.8912H193.997V38.3459C193.997 38.5647 193.91 38.7746 193.756 38.9294C193.602 39.0841 193.392 39.1711 193.174 39.1711H188.318C186.736 39.1766 185.221 39.8089 184.102 40.9302C182.984 42.0515 182.353 43.5707 182.348 45.1564V47.2977H193.174C194.35 47.3032 195.516 47.0757 196.604 46.6283C197.692 46.1809 198.682 45.5224 199.515 44.6906C200.349 43.8588 201.01 42.8701 201.462 41.7813C201.913 40.6924 202.145 39.525 202.145 38.3459L202.062 19.2305Z"
        fill="white"
      />
      <path
        d="M72.3347 32.2772V47.2144H80.4414V26.668H77.9302C77.195 26.6666 76.4668 26.8107 75.7873 27.0922C75.1078 27.3736 74.4904 27.7867 73.9705 28.3078C73.4507 28.829 73.0386 29.4479 72.7579 30.129C72.4771 30.8102 72.3334 31.5402 72.3347 32.2772Z"
        fill="white"
      />
      <path
        d="M95.5502 19.2305H84.2343V41.6467C84.2343 43.1232 84.8194 44.5394 85.8609 45.5835C86.9025 46.6276 88.3151 47.2141 89.788 47.2141H92.3409V27.3676H95.5502C95.6583 27.3676 95.7654 27.3889 95.8652 27.4304C95.9651 27.4719 96.0559 27.5326 96.1323 27.6093C96.2087 27.6859 96.2694 27.7769 96.3107 27.877C96.3521 27.9771 96.3734 28.0844 96.3734 28.1928V47.2141H104.48V28.2032C104.483 27.0276 104.255 25.863 103.808 24.7759C103.362 23.6888 102.707 22.7004 101.879 21.8672C101.052 21.034 100.069 20.3723 98.9868 19.9199C97.9044 19.4675 96.7438 19.2332 95.5711 19.2305H95.5502Z"
        fill="white"
      />
      <path
        d="M76.3569 23.4399C77.1152 23.4399 77.8566 23.2144 78.4872 22.7921C79.1178 22.3697 79.6093 21.7693 79.8995 21.0669C80.1897 20.3646 80.2656 19.5917 80.1177 18.846C79.9697 18.1003 79.6045 17.4154 79.0683 16.8778C78.532 16.3402 77.8488 15.9741 77.1049 15.8258C76.3611 15.6775 75.5901 15.7536 74.8895 16.0446C74.1888 16.3355 73.5899 16.8282 73.1686 17.4603C72.7472 18.0925 72.5223 18.8357 72.5223 19.5959C72.5223 20.6154 72.9263 21.5931 73.6454 22.314C74.3646 23.0349 75.3399 23.4399 76.3569 23.4399Z"
        fill="white"
      />
    </g>
    <defs>
      <clipPath id="clip0_3050_26">
        <rect width="202.323" height="64" fill="white" />
      </clipPath>
    </defs>
  </svg>
)
